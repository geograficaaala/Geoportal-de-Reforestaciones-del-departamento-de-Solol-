<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geoportal de Reforestaci√≥n ‚Äì Solol√°</title>
  <meta name="description" content="Portal p√∫blico con mapa, tablero e informes de reforestaci√≥n en Solol√°." />

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg: #fbfdff;
      --text: rgba(11, 24, 38, .92);
      --muted: rgba(11, 24, 38, .62);
      --stroke: rgba(11, 24, 38, .10);
      --card: rgba(255,255,255,.78);
      --shadow: 0 18px 55px rgba(10,25,40,.12);
      --radius: 24px;

      --mint: rgba(176,255,216,.70);
      --sky: rgba(170,225,255,.70);
      --rose: rgba(255,200,230,.62);
      --butter: rgba(255,244,176,.65);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      overflow-x:hidden;
    }

    /* Fondo pastel */
    .bg{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(900px 540px at 10% 10%, var(--mint), transparent 60%),
        radial-gradient(860px 520px at 85% 15%, var(--sky), transparent 58%),
        radial-gradient(800px 540px at 90% 78%, var(--rose), transparent 58%),
        radial-gradient(760px 520px at 12% 84%, var(--butter), transparent 60%),
        linear-gradient(180deg, #ffffff, #fbfdff);
    }

    .container{ max-width: 1180px; margin:0 auto; padding: 0 20px; }

    /* Header */
    header{
      position:sticky; top:0; z-index:30;
      background: rgba(255,255,255,.65);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--stroke);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 0;
      gap: 14px;
    }

    /* Logos (2) */
    .logos{
      display:flex; align-items:center; gap: 12px;
      min-width: 260px;
    }
    .logoBox{
      height: 52px;
      width: 140px;           /* m√°s grande */
      border-radius: 18px;
      background: rgba(255,255,255,.85);
      border: 1px solid var(--stroke);
      box-shadow: 0 10px 24px rgba(10,25,40,.10);
      display:grid; place-items:center;
      overflow:hidden;
      padding: 6px 10px;
    }
    .logoBox img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display:block;
    }

    .brandText{
      display:flex; flex-direction:column;
      gap: 2px;
      margin-left: 6px;
    }
    .title{
      font-weight: 950;
      letter-spacing:-.02em;
      line-height:1.1;
      font-size: 15px;
    }
    .subtitle{
      font-size: 12px;
      color: var(--muted);
      font-weight: 750;
    }

    nav a{
      text-decoration:none;
      color: var(--muted);
      font-weight: 850;
      font-size: 14px;
    }
    nav a:hover{ color: var(--text); }

    .actions{ display:flex; gap: 10px; align-items:center; }
    .btn{
      appearance:none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.80);
      border-radius: 16px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight: 900;
      box-shadow: 0 10px 22px rgba(10,25,40,.08);
      transition: transform .12s ease;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.primary{
      border:none;
      background: linear-gradient(135deg, rgba(125,235,255,.95), rgba(170,255,210,.95), rgba(255,206,236,.95));
    }

    @media (max-width: 980px){
      nav{ display:none; }
      .logoBox{ width: 120px; }
    }
    @media (max-width: 560px){
      .logos{ min-width: unset; gap: 8px; }
      .logoBox{ width: 104px; height: 46px; }
      .actions .btn{ padding: 9px 12px; }
    }

    /* HERO: menos alto para que no quede ‚Äúvac√≠o‚Äù */
    .hero{
      padding: 44px 0 26px;
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 980px){
      .hero-grid{ grid-template-columns: 1fr; }
    }

    h1{
      margin: 0;
      font-size: 54px;
      line-height: 1.03;
      letter-spacing: -0.045em;
    }
    @media (max-width: 560px){
      h1{ font-size: 40px; }
    }

    .lead{
      margin-top: 14px;
      color: var(--muted);
      font-size: 16px;
      line-height: 1.75;
      max-width: 68ch;
    }

    .badge-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.72);
      font-size: 12px;
      font-weight: 900;
      color: rgba(11,24,38,.75);
    }

    .hero-actions{ margin-top: 18px; display:flex; gap: 10px; flex-wrap:wrap; }

    /* Card */
    .card{
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    .kpis{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    .kpi{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.72);
      padding: 12px;
    }
    .kpi .l{ font-size:12px; font-weight: 900; color: var(--muted); }
    .kpi .v{ margin-top: 6px; font-size: 22px; font-weight: 950; letter-spacing:-.02em; }
    .kpi .s{ margin-top: 4px; font-size:12px; color: var(--muted); font-weight: 700; }

    /* Secciones */
    .section{ padding: 26px 0 42px; }
    .section h2{ margin:0; font-size: 28px; letter-spacing:-.02em; }
    .section p{ margin: 10px 0 0; color: var(--muted); line-height:1.65; }

    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .tile{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.82);
      box-shadow: var(--shadow);
      padding: 18px;
      cursor:pointer;
      transition: transform .12s ease;
      position: relative;
      overflow:hidden;
    }
    .tile::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 240px at 20% 0%, var(--mint), transparent 58%),
        radial-gradient(520px 240px at 95% 30%, var(--sky), transparent 58%),
        radial-gradient(520px 240px at 80% 110%, var(--rose), transparent 58%),
        radial-gradient(520px 240px at 10% 110%, var(--butter), transparent 58%);
      opacity: .78;
      z-index: -1;
    }
    .tile:hover{ transform: translateY(-2px); }
    .tile h3{ margin: 12px 0 6px; font-size: 18px; }
    .tile p{ margin:0; color: var(--muted); font-size: 14px; line-height:1.55; }
    .pill{
      display:inline-flex;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      font-size: 12px;
      font-weight: 950;
      color: rgba(11,24,38,.70);
    }

    .panel{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.85);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      padding: 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      border-bottom: 1px solid var(--stroke);
      flex-wrap: wrap;
    }
    .panel-head .right{ display:flex; gap:10px; flex-wrap:wrap; }
    .meta{ font-size: 13px; color: var(--muted); font-weight: 700; margin-top: 4px; }
    .hidden{ display:none; }

    #map{ height: 560px; } /* un poco m√°s alto */
    @media (max-width: 560px){
      #map{ height: 520px; }
    }

    footer{
      border-top: 1px solid var(--stroke);
      padding: 22px 0 40px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 700;
    }

    code{ background: rgba(11,24,38,.06); padding: 2px 6px; border-radius: 10px; border: 1px solid rgba(11,24,38,.08); }
  </style>
</head>

<body>
  <div class="bg"></div>

  <header>
    <div class="container nav">
      <!-- 2 logos + texto -->
      <div class="logos">
        <div class="logoBox" title="BOSQUE">
          <img src="BOSQUE.png" alt="BOSQUE" onerror="this.style.display='none'">
        </div>
        <div class="logoBox" title="CODEMA">
          <img src="CODEMA%20(2).png" alt="CODEMA" onerror="this.style.display='none'">
        </div>
        <div class="brandText">
          <div class="title">Geoportal de Reforestaci√≥n</div>
          <div class="subtitle">Solol√° ¬∑ Consulta p√∫blica</div>
        </div>
      </div>

      <nav aria-label="Navegaci√≥n">
        <a href="#inicio">Inicio</a>
        <a href="#explorar">Explorar</a>
      </nav>

      <div class="actions">
        <button class="btn" id="btnExplore">Explorar</button>
        <button class="btn primary" id="btnMapa">Mapa</button>
      </div>
    </div>
  </header>

  <main id="inicio" class="hero">
    <div class="container">
      <div class="hero-grid">
        <section>
          <h1>
            Reforestaci√≥n visible<br>
            con <span style="background:linear-gradient(90deg,#49e6a7,#63d7ff,#ffb6de,#ffe68c);-webkit-background-clip:text;background-clip:text;color:transparent;">datos y mapas</span>.
          </h1>
          <p class="lead">
            Explora reforestaciones registradas en campo: puntos georreferenciados, tracks (cuando existan),
            participaci√≥n y datos para auditor√≠a y transparencia.
          </p>

          <div class="badge-row">
            <span class="badge">üåø P√∫blico</span>
            <span class="badge">üõ∞Ô∏è Sat√©lite</span>
            <span class="badge">üó∫Ô∏è Mapa</span>
            <span class="badge">üìä Tablero</span>
            <span class="badge">üìÑ Informes</span>
          </div>

          <div class="hero-actions">
            <button class="btn primary" id="btnEmpezar">Empezar a explorar</button>
            <button class="btn" onclick="scrollToId('explorar')">Ver secciones</button>
          </div>
        </section>

        <aside class="card" aria-label="Indicadores">
          <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;">
            <div>
              <div style="font-weight:950;font-size:16px;">Indicadores</div>
              <div style="margin-top:6px;color:var(--muted);font-size:13px;line-height:1.55;">
                Se llenan cuando exista <code>data/resumen.json</code>.
              </div>
            </div>
            <span class="pill">pastel</span>
          </div>

          <div class="kpis">
            <div class="kpi">
              <div class="l">Boletas</div>
              <div class="v" id="kpiBoletas">‚Äî</div>
              <div class="s">registros</div>
            </div>
            <div class="kpi">
              <div class="l">Plantas</div>
              <div class="v" id="kpiPlantas">‚Äî</div>
              <div class="s">totales</div>
            </div>
            <div class="kpi">
              <div class="l">Participantes</div>
              <div class="v" id="kpiParticipantes">‚Äî</div>
              <div class="s">personas</div>
            </div>
            <div class="kpi">
              <div class="l">Actualizaci√≥n</div>
              <div class="v" style="font-size:16px;" id="kpiActualizacion">‚Äî</div>
              <div class="s">fecha</div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <section id="explorar" class="section">
    <div class="container">
      <h2>Explorar el portal</h2>
      <p>Elige una secci√≥n. Se abrir√° debajo cuando hagas clic.</p>

      <div class="grid">
        <div class="tile" onclick="openSection('mapa')">
          <span class="pill">Puntos ¬∑ tracks ¬∑ sat√©lite</span>
          <h3>Mapa</h3>
          <p>Explora reforestaciones en el mapa y abre cada registro para ver detalles.</p>
        </div>

        <div class="tile" onclick="openSection('tablero')">
          <span class="pill">Gr√°ficas ¬∑ tabla</span>
          <h3>Tablero</h3>
          <p>Indicadores por municipio e instituci√≥n, con res√∫menes bonitos.</p>
        </div>

        <div class="tile" onclick="openSection('informes')">
          <span class="pill">PDF ¬∑ CSV</span>
          <h3>Informes</h3>
          <p>Reportes mensuales/trimestrales y descargas p√∫blicas.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- MAPA -->
  <section id="mapa" class="section hidden">
    <div class="container">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div style="font-weight:950;font-size:18px;">Mapa interactivo (sat√©lite)</div>
            <div class="meta">Busca <code>data/puntos.geojson</code> y <code>data/tracks.geojson</code>.</div>
          </div>
          <div class="right">
            <button class="btn" id="btnFit">Ajustar vista</button>
            <button class="btn" onclick="closeSection('mapa')">Cerrar</button>
          </div>
        </div>
        <div id="map"></div>
        <div id="mapMsg" style="padding:16px;color:var(--muted);display:none;font-weight:700;"></div>
      </div>
    </div>
  </section>

  <!-- TABLERO -->
  <section id="tablero" class="section hidden">
    <div class="container">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div style="font-weight:950;font-size:18px;">Tablero</div>
            <div class="meta">Placeholder (luego lo conectamos a tus datos reales).</div>
          </div>
          <div class="right">
            <button class="btn" onclick="closeSection('tablero')">Cerrar</button>
          </div>
        </div>
        <div style="padding:16px;">
          <canvas id="chartDemo" height="120"></canvas>
          <div style="margin-top:10px;color:var(--muted);font-size:13px;line-height:1.6;font-weight:700;">
            En el siguiente paso lo conectamos a <code>/data</code>.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- INFORMES -->
  <section id="informes" class="section hidden">
    <div class="container">
      <div class="panel">
        <div class="panel-head">
          <div>
            <div style="font-weight:950;font-size:18px;">Informes</div>
            <div class="meta">Aqu√≠ ir√°n PDFs/CSVs generados autom√°ticamente.</div>
          </div>
          <div class="right">
            <button class="btn" onclick="closeSection('informes')">Cerrar</button>
          </div>
        </div>
        <div style="padding:16px;color:var(--muted);line-height:1.7;font-weight:700;">
          Pr√≥ximo paso: automatizar la generaci√≥n de reportes desde KoBo y publicarlos en este portal.
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;">
      <div>¬© <span id="year"></span> Geoportal de Reforestaci√≥n ‚Äì Solol√°</div>
      <div>GitHub Pages ¬∑ p√∫blico</div>
    </div>
  </footer>

  <script>
    // Datos (los crearemos despu√©s)
    const DATA_SUMMARY = "data/resumen.json";
    const DATA_POINTS  = "data/puntos.geojson";
    const DATA_TRACKS  = "data/tracks.geojson";

    const $ = (id) => document.getElementById(id);

    function scrollToId(id){ $(id)?.scrollIntoView({behavior:"smooth", block:"start"}); }

    // Secciones (landing)
    function openSection(id){
      ["mapa","tablero","informes"].forEach(s => $(s).classList.add("hidden"));
      $(id).classList.remove("hidden");
      history.replaceState(null,"","#"+id);
      setTimeout(()=>scrollToId(id), 30);

      if (id === "mapa") initMapOnce();
      if (id === "tablero") initChartOnce();
    }
    function closeSection(id){
      $(id).classList.add("hidden");
      history.replaceState(null,"","#explorar");
      setTimeout(()=>scrollToId("explorar"), 20);
    }
    window.openSection = openSection;
    window.closeSection = closeSection;

    $("btnExplore").addEventListener("click", ()=>scrollToId("explorar"));
    $("btnMapa").addEventListener("click", ()=>openSection("mapa"));
    $("btnEmpezar").addEventListener("click", ()=>scrollToId("explorar"));

    $("year").textContent = new Date().getFullYear();

    window.addEventListener("load", ()=>{
      const hash = (location.hash||"").replace("#","");
      if (["mapa","tablero","informes"].includes(hash)) openSection(hash);
      loadKPIs();
    });

    // KPIs
    async function loadKPIs(){
      try{
        const res = await fetch(DATA_SUMMARY, { cache:"no-store" });
        if (!res.ok) return;
        const j = await res.json();
        if (j.boletas != null) $("kpiBoletas").textContent = fmt(j.boletas);
        if (j.plantas != null) $("kpiPlantas").textContent = fmt(j.plantas);
        if (j.participantes != null) $("kpiParticipantes").textContent = fmt(j.participantes);
        if (j.actualizacion != null) $("kpiActualizacion").textContent = String(j.actualizacion);
      }catch(_){}
    }
    function fmt(n){
      try { return new Intl.NumberFormat("es-GT").format(Number(n)||0); }
      catch { return String(n); }
    }

    // MAPA: sat√©lite + opci√≥n calles
    let mapInited = false;
    let map, pointsLayer;

    async function initMapOnce(){
      if (mapInited) return;
      mapInited = true;

      if (!window.L){
        helpMap("Cargando librer√≠as del mapa‚Ä¶");
        return;
      }

      map = L.map("map", { scrollWheelZoom:true });

      // Capas base
      const streets = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors"
      });

      // Sat√©lite (Esri)
      const satellite = L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 19,
          attribution: "Tiles &copy; Esri"
        }
      );

      // Por defecto: sat√©lite
      satellite.addTo(map);

      // Control para cambiar base layers
      L.control.layers(
        { "Sat√©lite (Esri)": satellite, "Calles (OSM)": streets },
        null,
        { position: "topright" }
      ).addTo(map);

      // Vista inicial Atitl√°n
      map.setView([14.74, -91.16], 11);

      // Bot√≥n ajustar vista
      $("btnFit").addEventListener("click", () => {
        if (pointsLayer) {
          const b = pointsLayer.getBounds();
          if (b.isValid()) map.fitBounds(b.pad(0.12));
        } else {
          map.setView([14.74, -91.16], 11);
        }
      });

      // Puntos
      try{
        const pts = await fetch(DATA_POINTS, { cache:"no-store" }).then(r => r.ok ? r.json() : null);
        if (pts?.features?.length){
          pointsLayer = L.geoJSON(pts, {
            pointToLayer: (f, latlng) => L.circleMarker(latlng, { radius:7, weight:1.2, fillOpacity:.9 }),
            onEachFeature: (f, layer) => {
              const p = f.properties || {};
              layer.bindPopup(`
                <div style="min-width:240px;font-family:Inter,Arial,sans-serif">
                  <div style="font-weight:900;margin-bottom:6px">Reforestaci√≥n</div>
                  <div style="font-size:12px;opacity:.92">
                    <div><b>Fecha:</b> ${p.fecha_actividad || "‚Äî"}</div>
                    <div><b>Municipios:</b> ${p.municipios || p.municipio || "‚Äî"}</div>
                    <div><b>Instituci√≥n:</b> ${p.institucion_resp || "‚Äî"}</div>
                    <div><b>Plantas:</b> ${p.total_plantas ?? "‚Äî"}</div>
                  </div>
                </div>
              `);
            }
          }).addTo(map);

          const b = pointsLayer.getBounds();
          if (b.isValid()) map.fitBounds(b.pad(0.12));
        } else {
          helpMap("A√∫n no existe <code>data/puntos.geojson</code>. Cuando lo subas, el mapa se llenar√°.");
        }
      } catch(_){
        helpMap("No se pudo cargar <code>data/puntos.geojson</code>. Revisa que exista en tu repo.");
      }

      // Tracks (opcional)
      try{
        const tr = await fetch(DATA_TRACKS, { cache:"no-store" }).then(r => r.ok ? r.json() : null);
        if (tr?.features?.length){
          L.geoJSON(tr, { style: ()=>({ weight:4, opacity:.85 }) }).addTo(map);
        }
      } catch(_){}
    }

    function helpMap(html){
      const box = $("mapMsg");
      box.style.display = "block";
      box.innerHTML = html;
    }

    // Tablero demo
    let chartInited = false;
    function initChartOnce(){
      if (chartInited) return;
      chartInited = true;
      if (!window.Chart) return;

      new Chart($("chartDemo"), {
        type: "bar",
        data: {
          labels: ["Solol√°", "Panajachel", "Santiago Atitl√°n", "Santa Cruz"],
          datasets: [{ label: "Plantas (demo)", data: [1200, 900, 760, 420] }]
        },
        options: { plugins: { legend: { display:false } } }
      });
    }
  </script>
</body>
</html>